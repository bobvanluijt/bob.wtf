language: python
python:
  - "3.7"
install:
  - pip3 install -r requirements.txt
before_install:
  - git config --global user.name "bobvanluijt"
  - sudo apt-get -y install unzip
  - openssl aes-256-cbc -K $encrypted_41570feb3951_key -iv $encrypted_41570feb3951_iv  -in getStats.zip.enc -out getStats.zip -d
  - unzip getStats.zip
script:
  - python3 ./getStats/getStats.py $(date +%Y) $(date +%W)
  - python3 renderStats.py
  - |
    CHANGED=$(git status -s | wc -l)
    if [ "$CHANGED" -gt 0 ]; then
      git config credential.helper "store --file=.git/credentials"
      echo "https://${GH_TOKEN}:@github.com" > .git/credentials
      git add -A
      git commit -m "ðŸ¤– bleep bloop => auto updated website"
      git push
    fi